//=============================================================================
//
// フィールド処理 [field.cpp]
// Author : 呉優
//
//=============================================================================

//*****************************************************************************
// インクルードファイル
//*****************************************************************************
#include "field.h"
#include "score.h"

//*****************************************************************************
// マクロ定義
//*****************************************************************************
#define		SCORE_INDEX			(2)			// SCORE表示の行番
#define		SPEED_INDEX			(5)			// SPEED表示の行番
//*****************************************************************************
// プロトタイプ宣言
//*****************************************************************************

//*****************************************************************************
// グローバル変数
//*****************************************************************************

// オリジナルフィールドデータ(横を+1しているのはNULLの分)
char field_org[DISP_H][DISP_W + 1] = {
	"+----------------------------------------------------------+                    ",
	"|                                                          |  SCORE:",
	"|                                                          |  ",
	"|                                                          |                    ",
	"|                                                          |  SPEED:",
	"|                                                          |  ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"+----------------------------------------------------------+                    ",
};
// 表示用フィールドデータ
char field[DISP_H][DISP_W + 1] = {
	"+----------------------------------------------------------+                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"|                                                          |                    ",
	"+----------------------------------------------------------+                    ",
};

//=============================================================================
// フィールドの初期化処理
//=============================================================================
void InitField(void) {
	// オリジナルフィールドデータを表示用データへコピー
	memcpy(field, field_org, sizeof(field));
}

//=============================================================================
// フィールドの終了処理
//=============================================================================
void UninitField(void) {

}

//=============================================================================
// フィールドの更新処理
//=============================================================================
void UpdateField(void) {
	// オリジナルフィールドデータを表示用データへコピー
	memcpy(field, field_org, sizeof(field));
}

//=============================================================================
// フィールドの描画処理
//=============================================================================
void DrawField(void) {
	system("cls");

	// 処理落ち防止としてループは取りやめる
	printf("%s\n", field[0]);
	printf("%s\n", field[1]);
	printf("%s%10d\n", field[SCORE_INDEX], GetScore());
	printf("%s\n", field[3]);
	printf("%s\n", field[4]);
	printf("%s%10d\n", field[SPEED_INDEX], GetFPS());
	printf("%s\n", field[6]);
	printf("%s\n", field[7]);
	printf("%s\n", field[8]);
	printf("%s\n", field[9]);
	printf("%s\n", field[10]);
	printf("%s\n", field[11]);
	printf("%s\n", field[12]);
	printf("%s\n", field[13]);
	printf("%s\n", field[14]);
	printf("%s\n", field[15]);
	printf("%s\n", field[16]);
	printf("%s\n", field[17]);
	printf("%s\n", field[18]);
	printf("%s\n", field[19]);
	printf("%s\n", field[20]);
	printf("%s\n", field[21]);
	printf("%s\n", field[22]);
	printf("%s\n", field[23]);

	//for (int i = 0; i < DISP_H; i++) {
	//	if (i == SCORE_INDEX) {
	//		printf("%s%10d\n", field[i], GetScore());
	//	}
	//	else if (i == SPEED_INDEX) {
	//		printf("%s%10d\n", field[i], GetFPS());
	//	}
	//	else {
	//		printf("%s\n", field[i]);
	//	}
	//}
}

//=============================================================================
// フィールドを取得
//=============================================================================
char *GetField(void) {

	return field[0];
}

//=============================================================================
// 指定した座標を取得
//=============================================================================
char GetField(int x, int y) {

	return field[y][x];
}

//=============================================================================
// 指定した座標に1文字を書き込む
//=============================================================================
void SetField(int x, int y, char data) {

	field[y][x] = data;
}

//=============================================================================
// 指定した座標に文字列を書き込む
//=============================================================================
void SetField(int x, int y, char* data) {
	
	memcpy(&field[y][x], data, sizeof(data[0]) * strlen(data));
}

//=============================================================================
// 指定した座標をチェック
// 物がなければ0を、あれば1を返す
//=============================================================================
int CheckField(int x, int y) {

	int ans = 0;						// 0をセット

	char _data = field[y][x];			// その地点のマップデータを取得

	if (_data != ' ')
		ans = 1;						// 合ってるなら1をセット

	return ans;
}

//=============================================================================
// 指定した座標をチェック
// 引数の物でなければ0を、であれば1を返す
//=============================================================================
int CheckField(int x, int y, char data) {

	int ans = 0;						// 0をセット
	
	char _data = field[y][x];	// その地点のマップデータを取得

	if (_data == data)
		ans = 1;						// 合ってるなら1をセット
	
	return ans;
}